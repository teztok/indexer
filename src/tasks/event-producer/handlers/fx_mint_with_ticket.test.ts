import FxMintWithTicketHandler from './fx_mint_with_ticket';
import { transactionsToEvents } from '../event-producer';
import { Transactions } from '../../../types';

test('creates FX_MINT_WITH_TICKET events', async () => {
  const transactions: Transactions = [
    {
      id: 491874595897344,
      level: 3242233,
      timestamp: '2023-03-20T10:51:59Z',
      block: 'BMKUi1bGg6u4yT2rCeBJGBQ8MV8eaaN2qxN9g1j4nVTks623Fi7',
      hash: 'ooMU4SzsYqSjijDSJn9s123xsFtrnq1nKRgnwPQtYMUc7qoCoRr',
      counter: 14257202,
      sender: {
        alias: 'dddc',
        address: 'tz1MbT8XyxN3F6wPDWn1KMxTpFst6UJgw2pj',
      },
      target: {
        address: 'KT1Xpmp15KfqoePNW9HczFmqaGNHwadV2a3b',
      },
      amount: 0,
      parameter: {
        entrypoint: 'mint_with_ticket',
        value: {
          issuer_id: '26057',
          recipient: null,
          ticket_id: '1064',
          input_bytes:
            '0308010140280000000000000201000000000000000002006f0070006e006e0065003500340037006600660034006e006b003100340030007a00790038003600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
        },
      },
      status: 'applied',
      hasInternals: true,
      initiator: null,
      storage: {
        fees: '50',
        admin: 'tz1fepn7jZsCYBqCDhpM63hzh9g2Ytqk4Tpv',
        ledger: 411393,
        paused: false,
        big_map: 411397,
        metadata: 411394,
        addresses: 411389,
        lock_time: '3600',
        all_tokens: '26086',
        locked_eps: false,
        user_actions: 411396,
        codex_entries: 411390,
        reserve_methods: 411395,
        all_gentk_tokens: '433',
        pricing_contracts: {
          '0': {
            address: 'KT1V24J6FVuKPU3xy6gVF6wJ3zdRXBheQhaV',
            enabled: true,
          },
          '1': {
            address: 'KT1MFgHKorMWXeVL6qrpgjZmemirafppSg9q',
            enabled: true,
          },
        },
        codex_entries_count: '38',
        entrypoints_enabled: 411391,
        gentk_void_metadata: '697066733a2f2f516d5a5a56424b617044673277587a77704478646d4c39416836363568395a7a654a3967596462545a3447427a66',
        referrer_fees_share: '200',
        issuer_codex_updates: 411392,
      },
      diffs: [
        {
          bigmap: 411396,
          path: 'user_actions',
          action: 'update_key',
          content: {
            hash: 'expruziGWqKzaG89hpkbqQXMF71E7kV8TEwm3vV8zkvSs81fUr7znb',
            key: 'tz1MbT8XyxN3F6wPDWn1KMxTpFst6UJgw2pj',
            value: {
              last_minted: ['26057'],
              last_minted_time: '2023-03-20T10:51:59Z',
              last_issuer_minted: '0',
              last_issuer_minted_time: '1970-01-01T00:00:00Z',
            },
          },
        },
        {
          bigmap: 411393,
          path: 'ledger',
          action: 'update_key',
          content: {
            hash: 'exprvExjHfA6nRY9uxgtt3yRsz6Pfydpc2owdYqYZjWSZiKWZdSHtX',
            key: '26057',
            value: {
              tags: [],
              author: 'tz1WBfByKVzmEEJJCqgK4Dcz6W4DCCkgtNfV', // author
              supply: '1000',
              balance: '573',
              enabled: true,
              codex_id: '9',
              metadata: '697066733a2f2f516d567a663558785a437a6e726b316248444e4a357250736d7736314c7351363174586d4d376665744b32395350',
              reserves: [],
              royalties: '100',
              pricing_id: '0',
              has_tickets: true,
              open_editions: null,
              primary_split: [
                {
                  pct: '1000',
                  address: 'tz1WBfByKVzmEEJJCqgK4Dcz6W4DCCkgtNfV',
                },
              ],
              locked_seconds: '0',
              royalties_split: [
                {
                  pct: '1000',
                  address: 'tz1WBfByKVzmEEJJCqgK4Dcz6W4DCCkgtNfV',
                },
              ],
              input_bytes_size: '151',
              iterations_count: '225',
              timestamp_minted: '2023-03-19T23:46:59Z',
              lock_price_for_reserves: false,
            },
          },
        },
      ],
      nonce: null,
    },
    {
      id: 491874596945920,
      level: 3242233,
      timestamp: '2023-03-20T10:51:59Z',
      block: 'BMKUi1bGg6u4yT2rCeBJGBQ8MV8eaaN2qxN9g1j4nVTks623Fi7',
      hash: 'ooMU4SzsYqSjijDSJn9s123xsFtrnq1nKRgnwPQtYMUc7qoCoRr',
      counter: 14257202,
      sender: {
        address: 'KT1Xpmp15KfqoePNW9HczFmqaGNHwadV2a3b',
      },
      target: {
        address: 'KT19etLCjCCzTLFFAxsxLFsVYMRPetr2bTD5',
      },
      amount: 0,
      parameter: {
        entrypoint: 'consume',
        value: {
          owner: 'tz1MbT8XyxN3F6wPDWn1KMxTpFst6UJgw2pj',
          token_id: '1064',
          project_id: '26057',
        },
      },
      status: 'applied',
      hasInternals: false,
      initiator: {
        alias: 'dddc',
        address: 'tz1MbT8XyxN3F6wPDWn1KMxTpFst6UJgw2pj',
      },
      storage: {
        fees: '0',
        issuer: 'KT1Xpmp15KfqoePNW9HczFmqaGNHwadV2a3b',
        ledger: 411409,
        big_map: 411414,
        metadata: 411410,
        min_price: '100000',
        locked_eps: false,
        token_data: 411412,
        project_data: 411411,
        administrator: 'tz1fepn7jZsCYBqCDhpM63hzh9g2Ytqk4Tpv',
        last_token_id: '1065',
        token_metadata: 411413,
        available_balance: '0',
      },
      diffs: [
        {
          bigmap: 411413,
          path: 'token_metadata',
          action: 'remove_key',
          content: {
            hash: 'expru7HucJ8ieffMGrGyYpJmhReG24fmNJCv7YsFSDebgPcFuwSN57',
            key: '1064',
            value: {
              token_id: '1064',
              token_info: {
                '': '697066733a2f2f516d5a61537564637044565a694e6177526e7258664d5844513464486b3345616250314b43345a554a4d63327a39',
              },
            },
          },
        },
        {
          bigmap: 411412,
          path: 'token_data',
          action: 'remove_key',
          content: {
            hash: 'expru7HucJ8ieffMGrGyYpJmhReG24fmNJCv7YsFSDebgPcFuwSN57',
            key: '1064',
            value: {
              price: '10000000',
              minter: 'tz1MbT8XyxN3F6wPDWn1KMxTpFst6UJgw2pj',
              created_at: '2023-03-20T10:48:59Z',
              project_id: '26057',
              taxation_start: '2023-03-27T10:48:59Z',
              taxation_locked: '0',
            },
          },
        },
        {
          bigmap: 411409,
          path: 'ledger',
          action: 'remove_key',
          content: {
            hash: 'expru7HucJ8ieffMGrGyYpJmhReG24fmNJCv7YsFSDebgPcFuwSN57',
            key: '1064',
            value: 'tz1MbT8XyxN3F6wPDWn1KMxTpFst6UJgw2pj',
          },
        },
      ],
      nonce: 1,
    },
    {
      id: 491874597994496,
      level: 3242233,
      timestamp: '2023-03-20T10:51:59Z',
      block: 'BMKUi1bGg6u4yT2rCeBJGBQ8MV8eaaN2qxN9g1j4nVTks623Fi7',
      hash: 'ooMU4SzsYqSjijDSJn9s123xsFtrnq1nKRgnwPQtYMUc7qoCoRr',
      counter: 14257202,
      sender: {
        address: 'KT1Xpmp15KfqoePNW9HczFmqaGNHwadV2a3b',
      },
      target: {
        address: 'KT1EfsNuqwLAWDd3o4pvfUx1CAh5GMdTrRvr',
      },
      amount: 0,
      parameter: {
        entrypoint: 'mint',
        value: {
          address: 'tz1MbT8XyxN3F6wPDWn1KMxTpFst6UJgw2pj',
          metadata: {
            '': '697066733a2f2f516d5a5a56424b617044673277587a77704478646d4c39416836363568395a7a654a3967596462545a3447427a66',
          },
          token_id: '432',
          issuer_id: '26057',
          iteration: '225',
          royalties: '100',
          input_bytes:
            '0308010140280000000000000201000000000000000002006f0070006e006e0065003500340037006600660034006e006b003100340030007a00790038003600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
          royalties_split: [
            {
              pct: '1000',
              address: 'tz1WBfByKVzmEEJJCqgK4Dcz6W4DCCkgtNfV',
            },
          ],
        },
      },
      status: 'applied',
      hasInternals: false,
      initiator: {
        alias: 'dddc',
        address: 'tz1MbT8XyxN3F6wPDWn1KMxTpFst6UJgw2pj',
      },
      storage: {
        issuer: 'KT1Xpmp15KfqoePNW9HczFmqaGNHwadV2a3b',
        ledger: 411398,
        paused: false,
        signer: 'tz1e8XGv6ngNoLt1ZNkEi6sG1A39yF48iwdS',
        metadata: 411399,
        operators: 411400,
        all_tokens: '433',
        token_data: 411401,
        administrator: 'tz1fepn7jZsCYBqCDhpM63hzh9g2Ytqk4Tpv',
        token_metadata: 411402,
        treasury_address: 'tz1dtzgLYUHMhP6sWeFtFsHkHqyPezBBPLsZ',
      },
      diffs: [
        {
          bigmap: 411402,
          path: 'token_metadata',
          action: 'add_key',
          content: {
            hash: 'expruh3toKwBS2dqsVAUfHoYWwTft1hXP7fJQ5aUtqRnkA1oSr99XU',
            key: '432',
            value: {
              token_id: '432',
              token_info: {
                '': '697066733a2f2f516d5a5a56424b617044673277587a77704478646d4c39416836363568395a7a654a3967596462545a3447427a66',
              },
            },
          },
        },
        {
          bigmap: 411401,
          path: 'token_data',
          action: 'add_key',
          content: {
            hash: 'expruh3toKwBS2dqsVAUfHoYWwTft1hXP7fJQ5aUtqRnkA1oSr99XU',
            key: '432',
            value: {
              minter: 'tz1MbT8XyxN3F6wPDWn1KMxTpFst6UJgw2pj',
              assigned: false,
              issuer_id: '26057',
              iteration: '225',
              royalties: '100',
              input_bytes:
                '0308010140280000000000000201000000000000000002006f0070006e006e0065003500340037006600660034006e006b003100340030007a00790038003600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000',
              royalties_split: [
                {
                  pct: '1000',
                  address: 'tz1WBfByKVzmEEJJCqgK4Dcz6W4DCCkgtNfV',
                },
              ],
            },
          },
        },
        {
          bigmap: 411398,
          path: 'ledger',
          action: 'add_key',
          content: {
            hash: 'expruqji6m7eVXKc2Z7L2xbsv8mkVtzQwAnbqgk3WrdqXhWdi18sxw',
            key: {
              nat: '432',
              address: 'tz1MbT8XyxN3F6wPDWn1KMxTpFst6UJgw2pj',
            },
            value: '1',
          },
        },
      ],
      nonce: 2,
    },
    {
      id: 541763768942592,
      level: 3429929,
      timestamp: '2023-04-27T01:39:42Z',
      block: 'BLVTL4mZBmq6ZWEMBTa5XpfeBhTnNAWgJF2EM3rHAKWhb5J1vni',
      hash: 'onqG7TWyZdXM8ctsA4nmVAoLQBpmBoyU9svc24Gt2krZHGEodNW',
      counter: 40406705,
      sender: {
        address: 'tz1SUajztNSCqkkyKh36XfzDDSfh4hvwJKS2',
      },
      target: {
        address: 'KT1Xpmp15KfqoePNW9HczFmqaGNHwadV2a3b',
      },
      amount: 0,
      parameter: {
        entrypoint: 'mint_with_ticket',
        value: {
          issuer_id: '26659',
          recipient: null,
          ticket_id: '6129',
          input_bytes: '40360000000000000402030000010201003ff00000000000003fe3d70a3d70a3d7c04680000000000002',
        },
      },
      status: 'applied',
      hasInternals: true,
      initiator: null,
      storage: {
        fees: '50',
        admin: 'tz1fepn7jZsCYBqCDhpM63hzh9g2Ytqk4Tpv',
        ledger: 411393,
        paused: false,
        big_map: 411397,
        metadata: 411394,
        addresses: 411389,
        lock_time: '3600',
        all_tokens: '26885',
        locked_eps: false,
        user_actions: 411396,
        codex_entries: 411390,
        reserve_methods: 411395,
        all_gentk_tokens: '29668',
        pricing_contracts: {
          '0': {
            address: 'KT1V24J6FVuKPU3xy6gVF6wJ3zdRXBheQhaV',
            enabled: true,
          },
          '1': {
            address: 'KT1MFgHKorMWXeVL6qrpgjZmemirafppSg9q',
            enabled: true,
          },
        },
        codex_entries_count: '837',
        entrypoints_enabled: 411391,
        gentk_void_metadata: '697066733a2f2f516d5a5a56424b617044673277587a77704478646d4c39416836363568395a7a654a3967596462545a3447427a66',
        referrer_fees_share: '200',
        issuer_codex_updates: 411392,
      },
      diffs: [
        {
          bigmap: 411396,
          path: 'user_actions',
          action: 'update_key',
          content: {
            hash: 'expruhyHF9JahALKNpsVVgKgEmGXDgsFNVmdmA5ozoyFGkZ4MAxJ6F',
            key: 'tz1SUajztNSCqkkyKh36XfzDDSfh4hvwJKS2',
            value: {
              last_minted: ['26659'],
              last_minted_time: '2023-04-27T01:39:42Z',
              last_issuer_minted: '0',
              last_issuer_minted_time: '1970-01-01T00:00:00Z',
            },
          },
        },
        {
          bigmap: 411393,
          path: 'ledger',
          action: 'update_key',
          content: {
            hash: 'exprtu7LTFHAXY7nWk5kZhhvm2yadNGwGa5V96hmTPivarawm6JE6C',
            key: '26659',
            value: {
              tags: [],
              author: 'tz1gBXG9fg8RMDH69KfKqwoTH5sFDmzt5yzm',
              supply: '500',
              balance: '0',
              enabled: true,
              codex_id: '611',
              metadata: '697066733a2f2f516d53677677716764474b427676776f68356d4b754d6b71557547534b3443557a37564e4c506566566235725143',
              reserves: [
                {
                  data: '05020000001f07040a000000160000e1574254fd8dd2530d54ba4501dc12386075f6570000',
                  amount: '0',
                  method_id: '0',
                },
              ],
              royalties: '120',
              pricing_id: '1',
              has_tickets: true,
              open_editions: null,
              primary_split: [
                {
                  pct: '773',
                  address: 'tz1gBXG9fg8RMDH69KfKqwoTH5sFDmzt5yzm',
                },
                {
                  pct: '150',
                  address: 'tz1U9Ef6b4qGkVhSCHeTTVtAe6JbStEWZLyS',
                },
                {
                  pct: '77',
                  address: 'tz1dtzgLYUHMhP6sWeFtFsHkHqyPezBBPLsZ',
                },
              ],
              locked_seconds: '0',
              royalties_split: [
                {
                  pct: '900',
                  address: 'tz1gBXG9fg8RMDH69KfKqwoTH5sFDmzt5yzm',
                },
                {
                  pct: '100',
                  address: 'tz1U9Ef6b4qGkVhSCHeTTVtAe6JbStEWZLyS',
                },
              ],
              input_bytes_size: '42',
              iterations_count: '446',
              timestamp_minted: '2023-04-14T17:45:04Z',
              lock_price_for_reserves: false,
            },
          },
        },
      ],
      nonce: null,
    },
    {
      id: 541763769991168,
      level: 3429929,
      timestamp: '2023-04-27T01:39:42Z',
      block: 'BLVTL4mZBmq6ZWEMBTa5XpfeBhTnNAWgJF2EM3rHAKWhb5J1vni',
      hash: 'onqG7TWyZdXM8ctsA4nmVAoLQBpmBoyU9svc24Gt2krZHGEodNW',
      counter: 40406705,
      sender: {
        address: 'KT1Xpmp15KfqoePNW9HczFmqaGNHwadV2a3b',
      },
      target: {
        address: 'KT19etLCjCCzTLFFAxsxLFsVYMRPetr2bTD5',
      },
      amount: 0,
      parameter: {
        entrypoint: 'consume',
        value: {
          owner: 'tz1SUajztNSCqkkyKh36XfzDDSfh4hvwJKS2',
          token_id: '6129',
          project_id: '26659',
        },
      },
      status: 'applied',
      hasInternals: false,
      initiator: {
        address: 'tz1SUajztNSCqkkyKh36XfzDDSfh4hvwJKS2',
      },
      storage: {
        fees: '0',
        issuer: 'KT1Xpmp15KfqoePNW9HczFmqaGNHwadV2a3b',
        ledger: 411409,
        big_map: 411414,
        metadata: 411410,
        min_price: '100000',
        locked_eps: false,
        token_data: 411412,
        project_data: 411411,
        administrator: 'tz1fepn7jZsCYBqCDhpM63hzh9g2Ytqk4Tpv',
        last_token_id: '8492',
        token_metadata: 411413,
        available_balance: '0',
      },
      diffs: [
        {
          bigmap: 411413,
          path: 'token_metadata',
          action: 'remove_key',
          content: {
            hash: 'exprur5L8agBc6Ny3nMax2xR3Tx7Wz8E6cdTGVbWoz2GnVsQhQ2BDa',
            key: '6129',
            value: {
              token_id: '6129',
              token_info: {
                '': '697066733a2f2f516d5535487170417a354d3779796f484b62324c4b4536375a33356431316979326e7041377971753656574e6652',
              },
            },
          },
        },
        {
          bigmap: 411412,
          path: 'token_data',
          action: 'remove_key',
          content: {
            hash: 'exprur5L8agBc6Ny3nMax2xR3Tx7Wz8E6cdTGVbWoz2GnVsQhQ2BDa',
            key: '6129',
            value: {
              price: '2500000000',
              minter: 'tz1M5QPtZ6WLTkotfonH6QXNpncjUudVmTWN',
              created_at: '2023-04-14T19:10:28Z',
              project_id: '26659',
              taxation_start: '2023-04-24T19:10:28Z',
              taxation_locked: '14000000',
            },
          },
        },
        {
          bigmap: 411409,
          path: 'ledger',
          action: 'remove_key',
          content: {
            hash: 'exprur5L8agBc6Ny3nMax2xR3Tx7Wz8E6cdTGVbWoz2GnVsQhQ2BDa',
            key: '6129',
            value: 'tz1SUajztNSCqkkyKh36XfzDDSfh4hvwJKS2',
          },
        },
      ],
      nonce: 4,
    },
    {
      id: 541763771039744,
      level: 3429929,
      timestamp: '2023-04-27T01:39:42Z',
      block: 'BLVTL4mZBmq6ZWEMBTa5XpfeBhTnNAWgJF2EM3rHAKWhb5J1vni',
      hash: 'onqG7TWyZdXM8ctsA4nmVAoLQBpmBoyU9svc24Gt2krZHGEodNW',
      counter: 40406705,
      sender: {
        address: 'KT19etLCjCCzTLFFAxsxLFsVYMRPetr2bTD5',
      },
      target: {
        alias: 'zancan',
        address: 'tz1gBXG9fg8RMDH69KfKqwoTH5sFDmzt5yzm',
      },
      amount: 5411000,
      parameter: null,
      status: 'applied',
      hasInternals: false,
      initiator: {
        address: 'tz1SUajztNSCqkkyKh36XfzDDSfh4hvwJKS2',
      },
      storage: null,
      diffs: null,
      nonce: 6,
    },
    {
      id: 541763772088320,
      level: 3429929,
      timestamp: '2023-04-27T01:39:42Z',
      block: 'BLVTL4mZBmq6ZWEMBTa5XpfeBhTnNAWgJF2EM3rHAKWhb5J1vni',
      hash: 'onqG7TWyZdXM8ctsA4nmVAoLQBpmBoyU9svc24Gt2krZHGEodNW',
      counter: 40406705,
      sender: {
        address: 'KT19etLCjCCzTLFFAxsxLFsVYMRPetr2bTD5',
      },
      target: {
        address: 'tz1U9Ef6b4qGkVhSCHeTTVtAe6JbStEWZLyS',
      },
      amount: 1050000,
      parameter: null,
      status: 'applied',
      hasInternals: false,
      initiator: {
        address: 'tz1SUajztNSCqkkyKh36XfzDDSfh4hvwJKS2',
      },
      storage: null,
      diffs: null,
      nonce: 7,
    },
    {
      id: 541763773136896,
      level: 3429929,
      timestamp: '2023-04-27T01:39:42Z',
      block: 'BLVTL4mZBmq6ZWEMBTa5XpfeBhTnNAWgJF2EM3rHAKWhb5J1vni',
      hash: 'onqG7TWyZdXM8ctsA4nmVAoLQBpmBoyU9svc24Gt2krZHGEodNW',
      counter: 40406705,
      sender: {
        address: 'KT19etLCjCCzTLFFAxsxLFsVYMRPetr2bTD5',
      },
      target: {
        alias: 'FXHASH treasury',
        address: 'tz1dtzgLYUHMhP6sWeFtFsHkHqyPezBBPLsZ',
      },
      amount: 539000,
      parameter: null,
      status: 'applied',
      hasInternals: false,
      initiator: {
        address: 'tz1SUajztNSCqkkyKh36XfzDDSfh4hvwJKS2',
      },
      storage: null,
      diffs: null,
      nonce: 8,
    },
    {
      id: 541763774185472,
      level: 3429929,
      timestamp: '2023-04-27T01:39:42Z',
      block: 'BLVTL4mZBmq6ZWEMBTa5XpfeBhTnNAWgJF2EM3rHAKWhb5J1vni',
      hash: 'onqG7TWyZdXM8ctsA4nmVAoLQBpmBoyU9svc24Gt2krZHGEodNW',
      counter: 40406705,
      sender: {
        address: 'KT19etLCjCCzTLFFAxsxLFsVYMRPetr2bTD5',
      },
      target: {
        address: 'tz1SUajztNSCqkkyKh36XfzDDSfh4hvwJKS2',
      },
      amount: 7000000,
      parameter: null,
      status: 'applied',
      hasInternals: false,
      initiator: {
        address: 'tz1SUajztNSCqkkyKh36XfzDDSfh4hvwJKS2',
      },
      storage: null,
      diffs: null,
      nonce: 9,
    },
    {
      id: 541763775234048,
      level: 3429929,
      timestamp: '2023-04-27T01:39:42Z',
      block: 'BLVTL4mZBmq6ZWEMBTa5XpfeBhTnNAWgJF2EM3rHAKWhb5J1vni',
      hash: 'onqG7TWyZdXM8ctsA4nmVAoLQBpmBoyU9svc24Gt2krZHGEodNW',
      counter: 40406705,
      sender: {
        address: 'KT1Xpmp15KfqoePNW9HczFmqaGNHwadV2a3b',
      },
      target: {
        address: 'KT1EfsNuqwLAWDd3o4pvfUx1CAh5GMdTrRvr',
      },
      amount: 0,
      parameter: {
        entrypoint: 'mint',
        value: {
          address: 'tz1SUajztNSCqkkyKh36XfzDDSfh4hvwJKS2',
          metadata: {
            '': '697066733a2f2f516d5a5a56424b617044673277587a77704478646d4c39416836363568395a7a654a3967596462545a3447427a66',
          },
          token_id: '29667',
          issuer_id: '26659',
          iteration: '446',
          royalties: '120',
          input_bytes: '40360000000000000402030000010201003ff00000000000003fe3d70a3d70a3d7c04680000000000002',
          royalties_split: [
            {
              pct: '100',
              address: 'tz1U9Ef6b4qGkVhSCHeTTVtAe6JbStEWZLyS',
            },
            {
              pct: '900',
              address: 'tz1gBXG9fg8RMDH69KfKqwoTH5sFDmzt5yzm',
            },
          ],
        },
      },
      status: 'applied',
      hasInternals: false,
      initiator: {
        address: 'tz1SUajztNSCqkkyKh36XfzDDSfh4hvwJKS2',
      },
      storage: {
        issuer: 'KT1Xpmp15KfqoePNW9HczFmqaGNHwadV2a3b',
        ledger: 411398,
        paused: false,
        signer: 'tz1e8XGv6ngNoLt1ZNkEi6sG1A39yF48iwdS',
        metadata: 411399,
        operators: 411400,
        all_tokens: '29668',
        token_data: 411401,
        administrator: 'tz1fepn7jZsCYBqCDhpM63hzh9g2Ytqk4Tpv',
        token_metadata: 411402,
        treasury_address: 'tz1dtzgLYUHMhP6sWeFtFsHkHqyPezBBPLsZ',
      },
      diffs: [
        {
          bigmap: 411402,
          path: 'token_metadata',
          action: 'add_key',
          content: {
            hash: 'exprucgW5yTwvr2bCdYiXFvEwfxVc6sL3T2LKAd2avRanZr7suMchQ',
            key: '29667',
            value: {
              token_id: '29667',
              token_info: {
                '': '697066733a2f2f516d5a5a56424b617044673277587a77704478646d4c39416836363568395a7a654a3967596462545a3447427a66',
              },
            },
          },
        },
        {
          bigmap: 411401,
          path: 'token_data',
          action: 'add_key',
          content: {
            hash: 'exprucgW5yTwvr2bCdYiXFvEwfxVc6sL3T2LKAd2avRanZr7suMchQ',
            key: '29667',
            value: {
              minter: 'tz1SUajztNSCqkkyKh36XfzDDSfh4hvwJKS2',
              assigned: false,
              issuer_id: '26659',
              iteration: '446',
              royalties: '120',
              input_bytes: '40360000000000000402030000010201003ff00000000000003fe3d70a3d70a3d7c04680000000000002',
              royalties_split: [
                {
                  pct: '100',
                  address: 'tz1U9Ef6b4qGkVhSCHeTTVtAe6JbStEWZLyS',
                },
                {
                  pct: '900',
                  address: 'tz1gBXG9fg8RMDH69KfKqwoTH5sFDmzt5yzm',
                },
              ],
            },
          },
        },
        {
          bigmap: 411398,
          path: 'ledger',
          action: 'add_key',
          content: {
            hash: 'exprtyTpcyBa7ey1PB9Rh9RBzwvre7zjeaSzKHgG4N1jfLAfFsB6wi',
            key: {
              nat: '29667',
              address: 'tz1SUajztNSCqkkyKh36XfzDDSfh4hvwJKS2',
            },
            value: '1',
          },
        },
      ],
      nonce: 5,
    },
    {
      id: 545869928595456,
      level: 3444814,
      timestamp: '2023-04-29T16:16:23Z',
      block: 'BLgY3V43cqnkDqiCG9BRkv3a7hdECKpg1xWyv8GqGdSnuKhdAHF',
      hash: 'opUPbNZVzoVWnSm94h2Tm7Uujm7rw1BLjFGv61xMGgBYXqd4cdM',
      counter: 11758294,
      sender: {
        alias: 'mikegee',
        address: 'tz1QFFvtYHPdvPC72AtsxvoeLXDUE8YutqXa',
      },
      target: {
        address: 'KT1Xpmp15KfqoePNW9HczFmqaGNHwadV2a3b',
      },
      amount: 0,
      parameter: {
        entrypoint: 'mint_with_ticket',
        value: {
          issuer_id: '26659',
          recipient: null,
          ticket_id: '6196',
          input_bytes: '40438000000000000402030001010100013fa999999999999a3ff0000000000000401400000000000003',
        },
      },
      status: 'applied',
      hasInternals: true,
      initiator: null,
      storage: {
        fees: '50',
        admin: 'tz1fepn7jZsCYBqCDhpM63hzh9g2Ytqk4Tpv',
        ledger: 411393,
        paused: false,
        big_map: 411397,
        metadata: 411394,
        addresses: 411389,
        lock_time: '3600',
        all_tokens: '26927',
        locked_eps: false,
        user_actions: 411396,
        codex_entries: 411390,
        reserve_methods: 411395,
        all_gentk_tokens: '31156',
        pricing_contracts: {
          '0': {
            address: 'KT1V24J6FVuKPU3xy6gVF6wJ3zdRXBheQhaV',
            enabled: true,
          },
          '1': {
            address: 'KT1MFgHKorMWXeVL6qrpgjZmemirafppSg9q',
            enabled: true,
          },
        },
        codex_entries_count: '879',
        entrypoints_enabled: 411391,
        gentk_void_metadata: '697066733a2f2f516d5a5a56424b617044673277587a77704478646d4c39416836363568395a7a654a3967596462545a3447427a66',
        referrer_fees_share: '200',
        issuer_codex_updates: 411392,
      },
      diffs: [
        {
          bigmap: 411396,
          path: 'user_actions',
          action: 'update_key',
          content: {
            hash: 'expruXEZ7sjESMZzBRaeQ35QaYLTWPaSR9N8DV7kBL5rdwiRaz7dbg',
            key: 'tz1QFFvtYHPdvPC72AtsxvoeLXDUE8YutqXa',
            value: {
              last_minted: ['26659'],
              last_minted_time: '2023-04-29T16:16:15Z',
              last_issuer_minted: '0',
              last_issuer_minted_time: '1970-01-01T00:00:00Z',
            },
          },
        },
        {
          bigmap: 411393,
          path: 'ledger',
          action: 'update_key',
          content: {
            hash: 'exprtu7LTFHAXY7nWk5kZhhvm2yadNGwGa5V96hmTPivarawm6JE6C',
            key: '26659',
            value: {
              tags: [],
              author: 'tz1gBXG9fg8RMDH69KfKqwoTH5sFDmzt5yzm',
              supply: '500',
              balance: '0',
              enabled: true,
              codex_id: '611',
              metadata: '697066733a2f2f516d53677677716764474b427676776f68356d4b754d6b71557547534b3443557a37564e4c506566566235725143',
              reserves: [
                {
                  data: '05020000001f07040a000000160000e1574254fd8dd2530d54ba4501dc12386075f6570000',
                  amount: '0',
                  method_id: '0',
                },
              ],
              royalties: '120',
              pricing_id: '1',
              has_tickets: true,
              open_editions: null,
              primary_split: [
                {
                  pct: '773',
                  address: 'tz1gBXG9fg8RMDH69KfKqwoTH5sFDmzt5yzm',
                },
                {
                  pct: '150',
                  address: 'tz1U9Ef6b4qGkVhSCHeTTVtAe6JbStEWZLyS',
                },
                {
                  pct: '77',
                  address: 'tz1dtzgLYUHMhP6sWeFtFsHkHqyPezBBPLsZ',
                },
              ],
              locked_seconds: '0',
              royalties_split: [
                {
                  pct: '900',
                  address: 'tz1gBXG9fg8RMDH69KfKqwoTH5sFDmzt5yzm',
                },
                {
                  pct: '100',
                  address: 'tz1U9Ef6b4qGkVhSCHeTTVtAe6JbStEWZLyS',
                },
              ],
              input_bytes_size: '42',
              iterations_count: '453',
              timestamp_minted: '2023-04-14T17:45:04Z',
              lock_price_for_reserves: false,
            },
          },
        },
      ],
      nonce: null,
    },
    {
      id: 545869929644032,
      level: 3444814,
      timestamp: '2023-04-29T16:16:23Z',
      block: 'BLgY3V43cqnkDqiCG9BRkv3a7hdECKpg1xWyv8GqGdSnuKhdAHF',
      hash: 'opUPbNZVzoVWnSm94h2Tm7Uujm7rw1BLjFGv61xMGgBYXqd4cdM',
      counter: 11758294,
      sender: {
        address: 'KT1Xpmp15KfqoePNW9HczFmqaGNHwadV2a3b',
      },
      target: {
        address: 'KT19etLCjCCzTLFFAxsxLFsVYMRPetr2bTD5',
      },
      amount: 0,
      parameter: {
        entrypoint: 'consume',
        value: {
          owner: 'tz1QFFvtYHPdvPC72AtsxvoeLXDUE8YutqXa',
          token_id: '6196',
          project_id: '26659',
        },
      },
      status: 'applied',
      hasInternals: false,
      initiator: {
        alias: 'mikegee',
        address: 'tz1QFFvtYHPdvPC72AtsxvoeLXDUE8YutqXa',
      },
      storage: {
        fees: '0',
        issuer: 'KT1Xpmp15KfqoePNW9HczFmqaGNHwadV2a3b',
        ledger: 411409,
        big_map: 411414,
        metadata: 411410,
        min_price: '100000',
        locked_eps: false,
        token_data: 411412,
        project_data: 411411,
        administrator: 'tz1fepn7jZsCYBqCDhpM63hzh9g2Ytqk4Tpv',
        last_token_id: '8775',
        token_metadata: 411413,
        available_balance: '0',
      },
      diffs: [
        {
          bigmap: 411413,
          path: 'token_metadata',
          action: 'remove_key',
          content: {
            hash: 'exprvR2YdcUqbykDci7nZW4vSwcqpTV7P36QeF3UDrkHzpXecuqwer',
            key: '6196',
            value: {
              token_id: '6196',
              token_info: {
                '': '697066733a2f2f516d5535487170417a354d3779796f484b62324c4b4536375a33356431316979326e7041377971753656574e6652',
              },
            },
          },
        },
        {
          bigmap: 411412,
          path: 'token_data',
          action: 'remove_key',
          content: {
            hash: 'exprvR2YdcUqbykDci7nZW4vSwcqpTV7P36QeF3UDrkHzpXecuqwer',
            key: '6196',
            value: {
              price: '1898000000',
              minter: 'tz1VU5AyddB9peDPS3cCtKHMTBjz3cY9PPvZ',
              created_at: '2023-04-14T19:10:43Z',
              project_id: '26659',
              taxation_start: '2023-04-27T19:10:43Z',
              taxation_locked: '21257600',
            },
          },
        },
        {
          bigmap: 411409,
          path: 'ledger',
          action: 'remove_key',
          content: {
            hash: 'exprvR2YdcUqbykDci7nZW4vSwcqpTV7P36QeF3UDrkHzpXecuqwer',
            key: '6196',
            value: 'tz1QFFvtYHPdvPC72AtsxvoeLXDUE8YutqXa',
          },
        },
      ],
      nonce: 27,
    },
    {
      id: 545869930692608,
      level: 3444814,
      timestamp: '2023-04-29T16:16:23Z',
      block: 'BLgY3V43cqnkDqiCG9BRkv3a7hdECKpg1xWyv8GqGdSnuKhdAHF',
      hash: 'opUPbNZVzoVWnSm94h2Tm7Uujm7rw1BLjFGv61xMGgBYXqd4cdM',
      counter: 11758294,
      sender: {
        address: 'KT19etLCjCCzTLFFAxsxLFsVYMRPetr2bTD5',
      },
      target: {
        alias: 'zancan',
        address: 'tz1gBXG9fg8RMDH69KfKqwoTH5sFDmzt5yzm',
      },
      amount: 2054015,
      parameter: null,
      status: 'applied',
      hasInternals: false,
      initiator: {
        alias: 'mikegee',
        address: 'tz1QFFvtYHPdvPC72AtsxvoeLXDUE8YutqXa',
      },
      storage: null,
      diffs: null,
      nonce: 29,
    },
    {
      id: 545869931741184,
      level: 3444814,
      timestamp: '2023-04-29T16:16:23Z',
      block: 'BLgY3V43cqnkDqiCG9BRkv3a7hdECKpg1xWyv8GqGdSnuKhdAHF',
      hash: 'opUPbNZVzoVWnSm94h2Tm7Uujm7rw1BLjFGv61xMGgBYXqd4cdM',
      counter: 11758294,
      sender: {
        address: 'KT19etLCjCCzTLFFAxsxLFsVYMRPetr2bTD5',
      },
      target: {
        address: 'tz1U9Ef6b4qGkVhSCHeTTVtAe6JbStEWZLyS',
      },
      amount: 398580,
      parameter: null,
      status: 'applied',
      hasInternals: false,
      initiator: {
        alias: 'mikegee',
        address: 'tz1QFFvtYHPdvPC72AtsxvoeLXDUE8YutqXa',
      },
      storage: null,
      diffs: null,
      nonce: 30,
    },
    {
      id: 545869932789760,
      level: 3444814,
      timestamp: '2023-04-29T16:16:23Z',
      block: 'BLgY3V43cqnkDqiCG9BRkv3a7hdECKpg1xWyv8GqGdSnuKhdAHF',
      hash: 'opUPbNZVzoVWnSm94h2Tm7Uujm7rw1BLjFGv61xMGgBYXqd4cdM',
      counter: 11758294,
      sender: {
        address: 'KT19etLCjCCzTLFFAxsxLFsVYMRPetr2bTD5',
      },
      target: {
        alias: 'FXHASH treasury',
        address: 'tz1dtzgLYUHMhP6sWeFtFsHkHqyPezBBPLsZ',
      },
      amount: 204604,
      parameter: null,
      status: 'applied',
      hasInternals: false,
      initiator: {
        alias: 'mikegee',
        address: 'tz1QFFvtYHPdvPC72AtsxvoeLXDUE8YutqXa',
      },
      storage: null,
      diffs: null,
      nonce: 31,
    },
    {
      id: 545869933838336,
      level: 3444814,
      timestamp: '2023-04-29T16:16:23Z',
      block: 'BLgY3V43cqnkDqiCG9BRkv3a7hdECKpg1xWyv8GqGdSnuKhdAHF',
      hash: 'opUPbNZVzoVWnSm94h2Tm7Uujm7rw1BLjFGv61xMGgBYXqd4cdM',
      counter: 11758294,
      sender: {
        address: 'KT19etLCjCCzTLFFAxsxLFsVYMRPetr2bTD5',
      },
      target: {
        alias: 'mikegee',
        address: 'tz1QFFvtYHPdvPC72AtsxvoeLXDUE8YutqXa',
      },
      amount: 18600400,
      parameter: null,
      status: 'applied',
      hasInternals: false,
      initiator: {
        alias: 'mikegee',
        address: 'tz1QFFvtYHPdvPC72AtsxvoeLXDUE8YutqXa',
      },
      storage: null,
      diffs: null,
      nonce: 32,
    },
    {
      id: 545869934886912,
      level: 3444814,
      timestamp: '2023-04-29T16:16:23Z',
      block: 'BLgY3V43cqnkDqiCG9BRkv3a7hdECKpg1xWyv8GqGdSnuKhdAHF',
      hash: 'opUPbNZVzoVWnSm94h2Tm7Uujm7rw1BLjFGv61xMGgBYXqd4cdM',
      counter: 11758294,
      sender: {
        address: 'KT1Xpmp15KfqoePNW9HczFmqaGNHwadV2a3b',
      },
      target: {
        address: 'KT1EfsNuqwLAWDd3o4pvfUx1CAh5GMdTrRvr',
      },
      amount: 0,
      parameter: {
        entrypoint: 'mint',
        value: {
          address: 'tz1QFFvtYHPdvPC72AtsxvoeLXDUE8YutqXa',
          metadata: {
            '': '697066733a2f2f516d5a5a56424b617044673277587a77704478646d4c39416836363568395a7a654a3967596462545a3447427a66',
          },
          token_id: '31155',
          issuer_id: '26659',
          iteration: '453',
          royalties: '120',
          input_bytes: '40438000000000000402030001010100013fa999999999999a3ff0000000000000401400000000000003',
          royalties_split: [
            {
              pct: '100',
              address: 'tz1U9Ef6b4qGkVhSCHeTTVtAe6JbStEWZLyS',
            },
            {
              pct: '900',
              address: 'tz1gBXG9fg8RMDH69KfKqwoTH5sFDmzt5yzm',
            },
          ],
        },
      },
      status: 'applied',
      hasInternals: false,
      initiator: {
        alias: 'mikegee',
        address: 'tz1QFFvtYHPdvPC72AtsxvoeLXDUE8YutqXa',
      },
      storage: {
        issuer: 'KT1Xpmp15KfqoePNW9HczFmqaGNHwadV2a3b',
        ledger: 411398,
        paused: false,
        signer: 'tz1e8XGv6ngNoLt1ZNkEi6sG1A39yF48iwdS',
        metadata: 411399,
        operators: 411400,
        all_tokens: '31156',
        token_data: 411401,
        administrator: 'tz1fepn7jZsCYBqCDhpM63hzh9g2Ytqk4Tpv',
        token_metadata: 411402,
        treasury_address: 'tz1dtzgLYUHMhP6sWeFtFsHkHqyPezBBPLsZ',
      },
      diffs: [
        {
          bigmap: 411402,
          path: 'token_metadata',
          action: 'add_key',
          content: {
            hash: 'exprtsq6J4Qx6XwaWRdDRnwhTZhBTJRVSmBmjJ7U4HxHutkAX5ozRD',
            key: '31155',
            value: {
              token_id: '31155',
              token_info: {
                '': '697066733a2f2f516d5a5a56424b617044673277587a77704478646d4c39416836363568395a7a654a3967596462545a3447427a66',
              },
            },
          },
        },
        {
          bigmap: 411401,
          path: 'token_data',
          action: 'add_key',
          content: {
            hash: 'exprtsq6J4Qx6XwaWRdDRnwhTZhBTJRVSmBmjJ7U4HxHutkAX5ozRD',
            key: '31155',
            value: {
              minter: 'tz1QFFvtYHPdvPC72AtsxvoeLXDUE8YutqXa',
              assigned: false,
              issuer_id: '26659',
              iteration: '453',
              royalties: '120',
              input_bytes: '40438000000000000402030001010100013fa999999999999a3ff0000000000000401400000000000003',
              royalties_split: [
                {
                  pct: '100',
                  address: 'tz1U9Ef6b4qGkVhSCHeTTVtAe6JbStEWZLyS',
                },
                {
                  pct: '900',
                  address: 'tz1gBXG9fg8RMDH69KfKqwoTH5sFDmzt5yzm',
                },
              ],
            },
          },
        },
        {
          bigmap: 411398,
          path: 'ledger',
          action: 'add_key',
          content: {
            hash: 'exprtgTmRczzpsmjhyB5rDdPiwXaUxmqefx7Pv5rUWJ4GiDR6ksC9f',
            key: {
              nat: '31155',
              address: 'tz1QFFvtYHPdvPC72AtsxvoeLXDUE8YutqXa',
            },
            value: '1',
          },
        },
      ],
      nonce: 28,
    },
  ];

  const events = transactionsToEvents(transactions, [FxMintWithTicketHandler]);

  expect(events).toStrictEqual([
    {
      id: '2c974f8ed9ae49aefb985b3f7b39d5c8',
      type: 'FX_MINT_WITH_TICKET',
      opid: '491874595897344',
      ophash: 'ooMU4SzsYqSjijDSJn9s123xsFtrnq1nKRgnwPQtYMUc7qoCoRr',
      timestamp: '2023-03-20T10:51:59Z',
      level: 3242233,
      fa2_address: 'KT1EfsNuqwLAWDd3o4pvfUx1CAh5GMdTrRvr',
      token_id: '432',
      editions: '1',
      ticket_fa2_address: 'KT19etLCjCCzTLFFAxsxLFsVYMRPetr2bTD5',
      ticket_token_id: '1064',
      seller_address: 'tz1WBfByKVzmEEJJCqgK4Dcz6W4DCCkgtNfV',
      artist_address: 'tz1WBfByKVzmEEJJCqgK4Dcz6W4DCCkgtNfV',
      buyer_address: 'tz1MbT8XyxN3F6wPDWn1KMxTpFst6UJgw2pj',
      is_verified_artist: false,
      issuer_id: '26057',
      royalties: '100',
      iteration: '225',
      metadata_uri: 'ipfs://QmZZVBKapDg2wXzwpDxdmL9Ah665h9ZzeJ9gYdbTZ4GBzf',
      royalty_shares: {
        decimals: 6,
        shares: {
          tz1WBfByKVzmEEJJCqgK4Dcz6W4DCCkgtNfV: '100000',
        },
      },
    },
    {
      artist_address: 'tz1gBXG9fg8RMDH69KfKqwoTH5sFDmzt5yzm',
      buyer_address: 'tz1SUajztNSCqkkyKh36XfzDDSfh4hvwJKS2',
      editions: '1',
      fa2_address: 'KT1EfsNuqwLAWDd3o4pvfUx1CAh5GMdTrRvr',
      id: '7e15f19768800ed2396a1dcb7cd68e72',
      is_verified_artist: false,
      issuer_id: '26659',
      iteration: '446',
      level: 3429929,
      metadata_uri: 'ipfs://QmZZVBKapDg2wXzwpDxdmL9Ah665h9ZzeJ9gYdbTZ4GBzf',
      ophash: 'onqG7TWyZdXM8ctsA4nmVAoLQBpmBoyU9svc24Gt2krZHGEodNW',
      opid: '541763768942592',
      royalties: '120',
      royalty_shares: {
        decimals: 6,
        shares: {
          tz1U9Ef6b4qGkVhSCHeTTVtAe6JbStEWZLyS: '12000',
          tz1gBXG9fg8RMDH69KfKqwoTH5sFDmzt5yzm: '108000',
        },
      },
      seller_address: 'tz1gBXG9fg8RMDH69KfKqwoTH5sFDmzt5yzm',
      ticket_fa2_address: 'KT19etLCjCCzTLFFAxsxLFsVYMRPetr2bTD5',
      ticket_token_id: '6129',
      timestamp: '2023-04-27T01:39:42Z',
      token_id: '29667',
      type: 'FX_MINT_WITH_TICKET',
    },
    {
      artist_address: 'tz1gBXG9fg8RMDH69KfKqwoTH5sFDmzt5yzm',
      buyer_address: 'tz1QFFvtYHPdvPC72AtsxvoeLXDUE8YutqXa',
      editions: '1',
      fa2_address: 'KT1EfsNuqwLAWDd3o4pvfUx1CAh5GMdTrRvr',
      id: '83d89de890d43c27becbe7d84580170a',
      is_verified_artist: false,
      issuer_id: '26659',
      iteration: '453',
      level: 3444814,
      metadata_uri: 'ipfs://QmZZVBKapDg2wXzwpDxdmL9Ah665h9ZzeJ9gYdbTZ4GBzf',
      ophash: 'opUPbNZVzoVWnSm94h2Tm7Uujm7rw1BLjFGv61xMGgBYXqd4cdM',
      opid: '545869928595456',
      royalties: '120',
      royalty_shares: {
        decimals: 6,
        shares: {
          tz1U9Ef6b4qGkVhSCHeTTVtAe6JbStEWZLyS: '12000',
          tz1gBXG9fg8RMDH69KfKqwoTH5sFDmzt5yzm: '108000',
        },
      },
      seller_address: 'tz1gBXG9fg8RMDH69KfKqwoTH5sFDmzt5yzm',
      ticket_fa2_address: 'KT19etLCjCCzTLFFAxsxLFsVYMRPetr2bTD5',
      ticket_token_id: '6196',
      timestamp: '2023-04-29T16:16:23Z',
      token_id: '31155',
      type: 'FX_MINT_WITH_TICKET',
    },
  ]);
});
